!function(t){var n={};function i(s){if(n[s])return n[s].exports;var e=n[s]={i:s,l:!1,exports:{}};return t[s].call(e.exports,e,e.exports,i),e.l=!0,e.exports}i.m=t,i.c=n,i.d=function(t,n,s){i.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="",i(i.s=0)}([function(t,n,i){"use strict";i.r(n);class s{constructor(t,n,i){this.x=t,this.y=n,this.z=i}_plus(t){return new s(this.x+t.x,this.y+t.y,this.z+t.z)}_minus(t){return new s(this.x-t.x,this.y-t.y,this.z-t.z)}_times(t){return new s(this.x*t.x,this.y*t.y,this.z*t.z)}_dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}_scale(t){return new s(t*this.x,t*this.y,t*this.z)}_linearInterpolation(t,n){return this._scale(1-n)._plus(t._scale(n))}asColor(){return new r(this.x,this.y,this.z)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalized(){let t=this.length();return new s(this.x/t,this.y/t,this.z/t)}}var e=s;class a{constructor(t,n,i){this.r=t,this.g=n,this.b=i}asVector3(){return new e(this.r,this.g,this.b)}rescale(t=0,n=255,i=0,s=255,e=0,r=255){let h=n-t,o=s-i,l=r-e,m=parseInt((this.r-t)/h*255),c=parseInt((this.g-i)/o*255),u=parseInt((this.b-e)/l*255);return new a(m,c,u)}clamped(){let t=this.r,n=this.g,i=this.b;return t<0?t=0:t>1&&(t=1),n<0?n=0:n>1&&(n=1),i<0?i=0:i>1&&(i=1),new a(t,n,i)}normalized(){return this.rescale(0,1,0,1,0,1)}}var r=a;var h=class{constructor(t=null,n=null,i=null,s=20){let e=new r(0,0,0);this.ambientConstant=null===t?e:t,this.diffuseConstant=null===n?e:n,this.specularConstant=null===i?e:i,this.shininess=s}};var o=class{constructor(t,n,i=null){this.center=t,this.radius=n,this.material=null===i?new h:i}intersection(t){let n=t.origin._minus(this.center),i=t.direction.length()*t.direction.length(),s=2*n._dot(t.direction),e=s*s-4*i*(n.length()*n.length()-this.radius*this.radius);if(e<0)return null;let a=(0-s+Math.sqrt(e))/(2*i),r=(0-s-Math.sqrt(e))/(2*i);if(a<0&&r<0)return null;let h=a;return r<a&&(h=r),h}colorAtIntersection(t,n,i=null){if(null===i)return this.color;let s=n.origin._plus(n.direction._scale(t)),a=s._minus(this.center).normalized(),r=i.ambientLightIntensity.asVector3()._times(this.material.ambientConstant.asVector3()),h=new e(0,0,0);for(var o=0;o<i.lights.length;++o){let t=i.lights[o],n=t.location._minus(s).normalized(),e=a._dot(n);if(e<0)continue;let l=t.diffuseIntensity.asVector3()._times(this.material.diffuseConstant.asVector3())._scale(e),m=a._scale(2*e)._minus(n),c=s._minus(i._view.camera).normalized(),u=t.specularIntensity.asVector3()._times(this.material.specularConstant.asVector3())._scale(Math.pow(Math.abs(c._dot(m)),this.material.shininess));h=h._plus(r)._plus(l)._plus(u),isNaN(h.x)&&console.log(u,c,m,c._dot(m),this.material.shininess,Math.pow(c._dot(m),this.material.shininess))}return h.asColor().clamped().normalized()}};var l=class{constructor(t,n=null,i=null){this.location=t,this.diffuseIntensity=null===n?new r(0,0,0):n,this.specularIntensity=null===i?new r(0,0,0):i}};var m=class{constructor(t=-2,n=2,i=-1,s=1,e=0,a=5){this.xmin=t,this.xmax=n,this.ymin=i,this.ymax=s,this.zmin=e,this.zmax=a,this.lights=[],this.objects=[],this._view=null,this.backgroundColor=new r(0,0,0),this.ambientLightIntensity=new r(.2,.2,.2)}getObjects(){return this.objects}randomizeAmbientLight(){this.ambientLightIntensity=new r(Math.random(),Math.random(),Math.random())}generateRandomLights(t=2){for(let n=0;n<t;++n){let t=new e(Math.random()*(this.xmax-this.xmin)+this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=new r(Math.random(),Math.random(),Math.random()),i=new r(Math.random(),Math.random(),Math.random()),s=new l(t,n,i);this.lights.push(s)}}generateBrightLights(t=2){for(let n=0;n<t;++n){let t=new e(Math.random()*(this.xmax-this.xmin)+this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=new r(.9,.9,.9),i=new r(.9,.9,.9),s=new l(t,n,i);this.lights.push(s)}}generateColoredLights(t=2,n=.9,i=.9,s=.9){for(let a=0;a<t;++a){let t=new e(this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),a=new r(n,i,s),h=new r(.8,.8,.8),o=new l(t,a,h);this.lights.push(o)}}generateSideLights(){let t=new e(this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=new r(Math.random(),Math.random(),Math.random()),i=new r(.8,.8,.8),s=new l(t,n,i);this.lights.push(s);let a=new e(this.xmax,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),h=new r(Math.random(),Math.random(),Math.random()),o=new r(.8,.8,.8),m=new l(a,h,o);this.lights.push(m)}generateRandomSpheres(t=5){for(var n=0;n<t;++n){let t=new e(Math.random()*(this.xmax-this.xmin)+this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=.9*Math.random()+.1,i=(Math.random(),Math.random(),Math.random(),new r(Math.random(),Math.random(),Math.random())),s=new r(Math.random(),Math.random(),Math.random()),a=new r(Math.random(),Math.random(),Math.random()),l=30*Math.random(),m=new h(i,s,a,l),c=new o(t,n,m);this.objects.push(c)}}};var c=class{constructor(t,n){this.w=t,this.h=n,this.canvas=this._createCanvas()}_createCanvas(){const t=document.createElement("canvas");t.setAttribute("width",this.w),t.setAttribute("height",this.h);const n=t.getContext("2d"),i=n.getImageData(0,0,this.w,this.h);return{canvas:t,context:n,imageData:i,pixels:i.data}}putPixel(t,n,i){const s=4*(n*this.w+t);this.canvas.pixels[s]=0|i.r,this.canvas.pixels[s+1]=0|i.g,this.canvas.pixels[s+2]=0|i.b,this.canvas.pixels[s+3]=255}renderInto(t){this.canvas.context.putImageData(this.canvas.imageData,0,0),t.appendChild(this.canvas.canvas)}};var u=class{constructor(t,n,i,s){this.x1=t,this.x2=n,this.x3=i,this.x4=s}};var d=class{constructor(t,n){this.origin=t,this.direction=n}};class x{constructor(t,n,i,s){this.camera=t,this.imagePlane=n,this.H=s,this.W=i}static createDefaultView(){const t=new u(new e(-1,.75,0),new e(1,.75,0),new e(-1,-.75,0),new e(1,-.75,0)),n=new e(0,0,-1);return new x(n,t,256,192)}_bilinearInterpolation(t,n){let i=t/this.W,s=(this.H-n-1)/this.H,e=this.imagePlane.x1._linearInterpolation(this.imagePlane.x2,i),a=this.imagePlane.x3._linearInterpolation(this.imagePlane.x4,i)._linearInterpolation(e,s);return{point:a,ray:new d(a,a._minus(this.camera))}}colorSnapshot(){const t=new c(this.W,this.H);for(let n=0;n<this.H;n++)for(let i=0;i<this.W;i++){let s=this._bilinearInterpolation(i,n);t.putPixel(i,n,s.ray.direction.asColor().rescale(-1,1,-.75,.75))}return console.log(.5,.5,.5,.5),t}viewScene(t){const n=new c(this.W,this.H);t._view=this;for(let i=0;i<this.H;i++)for(let s=0;s<this.W;s++){let e=this._bilinearInterpolation(s,i),a=t.backgroundColor,r=t.getObjects(),h=null,o=null;for(let t=0;t<r.length;++t){let n=r[t],i=n.intersection(e.ray);null!==i&&(null===h?(h=i,o=n):i<h&&(h=i,o=n))}null!==o&&(a=o.colorAtIntersection(h,e.ray,t)),n.putPixel(s,i,a)}return n}}var w=x;(function(){const t=w.createDefaultView();let n=new m;n.randomizeAmbientLight(),n.generateBrightLights(1),n.generateRandomSpheres(2),t.viewScene(n).renderInto(document.querySelector("body"))})()}]);