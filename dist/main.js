!function(t){var n={};function e(i){if(n[i])return n[i].exports;var s=n[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}([function(t,n,e){"use strict";e.r(n);class i{constructor(t,n,e){this.x=t,this.y=n,this.z=e}_plus(t){return new i(this.x+t.x,this.y+t.y,this.z+t.z)}_minus(t){return new i(this.x-t.x,this.y-t.y,this.z-t.z)}_times(t){return new i(this.x*t.x,this.y*t.y,this.z*t.z)}_dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}_scale(t){return new i(t*this.x,t*this.y,t*this.z)}_linearInterpolation(t,n){return this._scale(1-n)._plus(t._scale(n))}asColor(){return new r(this.x,this.y,this.z)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalized(){let t=this.length();return new i(this.x/t,this.y/t,this.z/t)}}var s=i;class a{constructor(t,n,e){this.r=t,this.g=n,this.b=e}asVector3(){return new s(this.r,this.g,this.b)}rescale(t=0,n=255,e=0,i=255,s=0,r=255){let h=n-t,o=i-e,l=r-s,c=parseInt((this.r-t)/h*255),u=parseInt((this.g-e)/o*255),m=parseInt((this.b-s)/l*255);return new a(c,u,m)}clamped(){let t=this.r,n=this.g,e=this.b;return t<0?t=0:t>1&&(t=1),n<0?n=0:n>1&&(n=1),e<0?e=0:e>1&&(e=1),new a(t,n,e)}normalized(){return this.rescale(0,1,0,1,0,1)}}var r=a;var h=class{constructor(t=null,n=null,e=null,i=20){let s=new r(0,0,0);this.ambientConstant=null===t?s:t,this.diffuseConstant=null===n?s:n,this.specularConstant=null===e?s:e,this.shininess=i}};var o=class{constructor(t,n,e=1,i=1,s=1,a=null){this.center=t,this.radius=n,this.color=new r(e,i,s),this.material=null===a?new h:a}intersection(t){let n=t.origin._minus(this.center),e=t.direction.length()*t.direction.length(),i=2*n._dot(t.direction),s=i*i-4*e*(n.length()*n.length()-this.radius*this.radius);if(s<0)return null;let a=(0-i+Math.sqrt(s))/(2*e),r=(0-i-Math.sqrt(s))/(2*e);if(a<0&&r<0)return null;let h=a;return r<a&&(h=r),h}colorAtIntersection(t,n,e=null){if(null===e)return this.color;let i=n.origin._plus(n.direction._scale(t)),s=i._minus(this.center).normalized(),a=e.ambientLightIntensity.asVector3()._times(this.material.ambientConstant.asVector3()),r=this.color.asVector3();for(var h=0;h<e.lights.length;++h){let t=e.lights[h],n=t.location._minus(i).normalized(),o=s._dot(n);if(o<0)continue;let l=t.diffuseIntensity.asVector3()._times(this.material.diffuseConstant.asVector3())._scale(o),c=s._scale(2*o)._minus(n),u=i._minus(e._view.camera).normalized(),m=t.specularIntensity.asVector3()._times(this.material.specularConstant.asVector3())._scale(Math.pow(u._dot(c),this.material.shininess));r=r._plus(a)._plus(l)._plus(m)}return r.asColor().clamped().normalized()}};var l=class{constructor(t,n=null,e=null){this.location=t,this.diffuseIntensity=null===n?new r(0,0,0):n,this.specularIntensity=null===e?new r(0,0,0):e}};var c=class{constructor(t=-2,n=2,e=-1,i=-1,s=0,a=5){this.xmin=t,this.xmax=n,this.ymin=e,this.ymax=i,this.zmin=s,this.zmax=a,this.lights=[],this.objects=[],this._view=null,this.backgroundColor=new r(0,0,0),this.ambientLightIntensity=new r(.2,.2,.2)}getObjects(){return this.objects}randomizeAmbientLight(){this.ambientLightIntensity=new r(Math.random(),Math.random(),Math.random())}generateRandomLights(t=2){for(let n=0;n<t;++n){let t=new s(Math.random()*(this.xmax-this.xmin)+this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=new r(Math.random(),Math.random(),Math.random()),e=new r(Math.random(),Math.random(),Math.random()),i=new l(t,n,e);this.lights.push(i)}}generateRandomSpheres(t=5){for(var n=0;n<t;++n){let t=new s(Math.random()*(this.xmax-this.xmin)+this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=.9*Math.random()+.1,e=Math.random(),i=Math.random(),a=Math.random(),l=new r(Math.random(),Math.random(),Math.random()),c=new r(Math.random(),Math.random(),Math.random()),u=new r(Math.random(),Math.random(),Math.random()),m=30*Math.random(),d=new h(l,c,u,m),x=new o(t,n,e,i,a,d);this.objects.push(x)}}};var u=class{constructor(t,n){this.w=t,this.h=n,this.canvas=this._createCanvas()}_createCanvas(){const t=document.createElement("canvas");t.setAttribute("width",this.w),t.setAttribute("height",this.h);const n=t.getContext("2d"),e=n.getImageData(0,0,this.w,this.h);return{canvas:t,context:n,imageData:e,pixels:e.data}}putPixel(t,n,e){const i=4*(n*this.w+t);this.canvas.pixels[i]=0|e.r,this.canvas.pixels[i+1]=0|e.g,this.canvas.pixels[i+2]=0|e.b,this.canvas.pixels[i+3]=255}renderInto(t){this.canvas.context.putImageData(this.canvas.imageData,0,0),t.appendChild(this.canvas.canvas)}};var m=class{constructor(t,n,e,i){this.x1=t,this.x2=n,this.x3=e,this.x4=i}};var d=class{constructor(t,n){this.origin=t,this.direction=n}};class x{constructor(t,n,e,i){this.camera=t,this.imagePlane=n,this.H=i,this.W=e}static createDefaultView(){const t=new m(new s(-1,.75,0),new s(1,.75,0),new s(-1,-.75,0),new s(1,-.75,0)),n=new s(0,0,-1);return new x(n,t,256,192)}_bilinearInterpolation(t,n){let e=t/this.W,i=(this.H-n-1)/this.H,s=this.imagePlane.x1._linearInterpolation(this.imagePlane.x2,e),a=this.imagePlane.x3._linearInterpolation(this.imagePlane.x4,e)._linearInterpolation(s,i);return{point:a,ray:new d(a,a._minus(this.camera))}}colorSnapshot(){const t=new u(this.W,this.H);for(let n=0;n<this.H;n++)for(let e=0;e<this.W;e++){let i=this._bilinearInterpolation(e,n);t.putPixel(e,n,i.ray.direction.asColor().rescale(-1,1,-.75,.75))}return console.log(.5,.5,.5,.5),t}viewScene(t){const n=new u(this.W,this.H);t._view=this;for(let e=0;e<this.H;e++)for(let i=0;i<this.W;i++){let s=this._bilinearInterpolation(i,e),a=t.backgroundColor,r=t.getObjects(),h=null,o=null;for(let t=0;t<r.length;++t){let n=r[t],e=n.intersection(s.ray);null!==e&&(null===h?(h=e,o=n):e<h&&(h=e,o=n))}null!==o&&(a=o.colorAtIntersection(h,s.ray,t)),n.putPixel(i,e,a)}return n}}var w=x;(function(){const t=w.createDefaultView();let n=new c;n.randomizeAmbientLight(),n.generateRandomLights(),n.generateRandomSpheres(),t.viewScene(n).renderInto(document.querySelector("body"))})()}]);