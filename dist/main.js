!function(t){var n={};function i(e){if(n[e])return n[e].exports;var s=n[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=n,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:e})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},i.p="",i(i.s=0)}([function(t,n,i){"use strict";i.r(n);class e{constructor(t,n,i){this.x=t,this.y=n,this.z=i}_plus(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z)}_minus(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z)}_times(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z)}_dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}_scale(t){return new e(t*this.x,t*this.y,t*this.z)}_linearInterpolation(t,n){return this._scale(1-n)._plus(t._scale(n))}asColor(){return new r(this.x,this.y,this.z)}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalized(){let t=this.length();return new e(this.x/t,this.y/t,this.z/t)}}var s=e;class a{constructor(t,n,i){this.r=t,this.g=n,this.b=i}asVector3(){return new s(this.r,this.g,this.b)}rescale(t=0,n=255,i=0,e=255,s=0,r=255){let h=n-t,o=e-i,l=r-s,m=parseInt((this.r-t)/h*255),c=parseInt((this.g-i)/o*255),u=parseInt((this.b-s)/l*255);return new a(m,c,u)}clamped(){let t=this.r,n=this.g,i=this.b;return t<0?t=0:t>1&&(t=1),n<0?n=0:n>1&&(n=1),i<0?i=0:i>1&&(i=1),new a(t,n,i)}normalized(){return this.rescale(0,1,0,1,0,1)}}var r=a;var h=class{constructor(t=null,n=null,i=null,e=20){let s=new r(0,0,0);this.ambientConstant=null===t?s:t,this.diffuseConstant=null===n?s:n,this.specularConstant=null===i?s:i,this.shininess=e}};var o=class{constructor(t,n,i=1,e=1,s=1,a=null){this.center=t,this.radius=n,this.color=new r(i,e,s),this.material=null===a?new h:a}intersection(t){let n=t.origin._minus(this.center),i=t.direction.length()*t.direction.length(),e=2*n._dot(t.direction),s=e*e-4*i*(n.length()*n.length()-this.radius*this.radius);if(s<0)return null;let a=(0-e+Math.sqrt(s))/(2*i),r=(0-e-Math.sqrt(s))/(2*i);if(a<0&&r<0)return null;let h=a;return r<a&&(h=r),h}colorAtIntersection(t,n,i=null){if(null===i)return this.color;let e=n.origin._plus(n.direction._scale(t)),s=e._minus(this.center).normalized(),a=i.ambientLightIntensity.asVector3()._times(this.material.ambientConstant.asVector3()),r=this.color.asVector3();for(var h=0;h<i.lights.length;++h){let t=i.lights[h],n=t.location._minus(e).normalized(),o=s._dot(n);if(o<0)continue;let l=t.diffuseIntensity.asVector3()._times(this.material.diffuseConstant.asVector3())._scale(o),m=s._scale(2*o)._minus(n),c=e._minus(i._view.camera).normalized(),u=t.specularIntensity.asVector3()._times(this.material.specularConstant.asVector3())._scale(Math.pow(Math.abs(c._dot(m)),this.material.shininess));r=r._plus(a)._plus(l)._plus(u),isNaN(r.x)&&console.log(u,c,m,c._dot(m),this.material.shininess,Math.pow(c._dot(m),this.material.shininess))}return r.asColor().clamped().normalized()}};var l=class{constructor(t,n=null,i=null){this.location=t,this.diffuseIntensity=null===n?new r(0,0,0):n,this.specularIntensity=null===i?new r(0,0,0):i}};var m=class{constructor(t=-2,n=2,i=-1,e=1,s=0,a=5){this.xmin=t,this.xmax=n,this.ymin=i,this.ymax=e,this.zmin=s,this.zmax=a,this.lights=[],this.objects=[],this._view=null,this.backgroundColor=new r(0,0,0),this.ambientLightIntensity=new r(.2,.2,.2)}getObjects(){return this.objects}randomizeAmbientLight(){this.ambientLightIntensity=new r(Math.random(),Math.random(),Math.random())}generateRandomLights(t=2){for(let n=0;n<t;++n){let t=new s(Math.random()*(this.xmax-this.xmin)+this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=new r(Math.random(),Math.random(),Math.random()),i=new r(Math.random(),Math.random(),Math.random()),e=new l(t,n,i);this.lights.push(e)}}generateBrightLights(t=2){for(let n=0;n<t;++n){let t=new s(Math.random()*(this.xmax-this.xmin)+this.xmin,1,Math.random()*(this.zmax-this.zmin)+this.zmin),n=new r(.9,.9,.9),i=new r(.9,.9,.9),e=new l(t,n,i);this.lights.push(e)}}generateColoredLights(t=2,n=.9,i=.9,e=.9){for(let a=0;a<t;++a){let t=new s(this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),a=new r(n,i,e),h=new r(.8,.8,.8),o=new l(t,a,h);this.lights.push(o)}}generateSideLights(){let t=new s(this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=new r(Math.random(),Math.random(),Math.random()),i=new r(.8,.8,.8),e=new l(t,n,i);this.lights.push(e);let a=new s(this.xmax,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),h=new r(Math.random(),Math.random(),Math.random()),o=new r(.8,.8,.8),m=new l(a,h,o);this.lights.push(m)}generateRandomSpheres(t=5){for(var n=0;n<t;++n){let t=new s(Math.random()*(this.xmax-this.xmin)+this.xmin,Math.random()*(this.ymax-this.ymin)+this.ymin,Math.random()*(this.zmax-this.zmin)+this.zmin),n=.9*Math.random()+.1,i=Math.random(),e=Math.random(),a=Math.random(),l=new r(Math.random(),Math.random(),Math.random()),m=new r(Math.random(),Math.random(),Math.random()),c=new r(Math.random(),Math.random(),Math.random()),u=30*Math.random(),d=new h(l,m,c,u),x=new o(t,n,i,e,a,d);this.objects.push(x)}}};var c=class{constructor(t,n){this.w=t,this.h=n,this.canvas=this._createCanvas()}_createCanvas(){const t=document.createElement("canvas");t.setAttribute("width",this.w),t.setAttribute("height",this.h);const n=t.getContext("2d"),i=n.getImageData(0,0,this.w,this.h);return{canvas:t,context:n,imageData:i,pixels:i.data}}putPixel(t,n,i){const e=4*(n*this.w+t);this.canvas.pixels[e]=0|i.r,this.canvas.pixels[e+1]=0|i.g,this.canvas.pixels[e+2]=0|i.b,this.canvas.pixels[e+3]=255}renderInto(t){this.canvas.context.putImageData(this.canvas.imageData,0,0),t.appendChild(this.canvas.canvas)}};var u=class{constructor(t,n,i,e){this.x1=t,this.x2=n,this.x3=i,this.x4=e}};var d=class{constructor(t,n){this.origin=t,this.direction=n}};class x{constructor(t,n,i,e){this.camera=t,this.imagePlane=n,this.H=e,this.W=i}static createDefaultView(){const t=new u(new s(-1,.75,0),new s(1,.75,0),new s(-1,-.75,0),new s(1,-.75,0)),n=new s(0,0,-1);return new x(n,t,256,192)}_bilinearInterpolation(t,n){let i=t/this.W,e=(this.H-n-1)/this.H,s=this.imagePlane.x1._linearInterpolation(this.imagePlane.x2,i),a=this.imagePlane.x3._linearInterpolation(this.imagePlane.x4,i)._linearInterpolation(s,e);return{point:a,ray:new d(a,a._minus(this.camera))}}colorSnapshot(){const t=new c(this.W,this.H);for(let n=0;n<this.H;n++)for(let i=0;i<this.W;i++){let e=this._bilinearInterpolation(i,n);t.putPixel(i,n,e.ray.direction.asColor().rescale(-1,1,-.75,.75))}return console.log(.5,.5,.5,.5),t}viewScene(t){const n=new c(this.W,this.H);t._view=this;for(let i=0;i<this.H;i++)for(let e=0;e<this.W;e++){let s=this._bilinearInterpolation(e,i),a=t.backgroundColor,r=t.getObjects(),h=null,o=null;for(let t=0;t<r.length;++t){let n=r[t],i=n.intersection(s.ray);null!==i&&(null===h?(h=i,o=n):i<h&&(h=i,o=n))}null!==o&&(a=o.colorAtIntersection(h,s.ray,t)),n.putPixel(e,i,a)}return n}}var w=x;(function(){const t=w.createDefaultView();let n=new m;n.randomizeAmbientLight(),n.generateSideLights(),n.generateRandomSpheres(2),t.viewScene(n).renderInto(document.querySelector("body"))})()}]);